<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>keeping availability group logins in sync automatically &ndash; dbatools</title>
<link rel="dns-prefetch" href="//secure.gravatar.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//use.fontawesome.com">

<link rel="alternate" type="application/rss+xml" title="dbatools &raquo; Feed" href="https://dbatools.io/feed/">
<link rel="alternate" type="application/rss+xml" title="dbatools &raquo; Comments Feed" href="https://dbatools.io/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="dbatools &raquo; keeping availability group logins in sync automatically Comments Feed" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="https://c0.wp.com/c/5.3.4/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="cpsh-shortcodes-css" href="https://dbatools.io/wp-content/plugins/column-shortcodes//assets/css/shortcodes.css?ver=1.0" type="text/css" media="all">
<link rel="stylesheet" id="onepress-fonts-css" href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C500%2C600%2C700%2C300%2C100%2C800%2C900%7COpen+Sans%3A400%2C300%2C300italic%2C400italic%2C600%2C600italic%2C700%2C700italic&amp;subset=latin%2Clatin-ext&amp;ver=11.0.0" type="text/css" media="all">
<link rel="stylesheet" id="onepress-animate-css" href="https://dbatools.io/wp-content/themes/onepress-master/assets/css/animate.min.css?ver=11.0.0" type="text/css" media="all">
<link rel="stylesheet" id="onepress-fa-css" href="https://dbatools.io/wp-content/themes/onepress-master/assets/css/font-awesome.min.css?ver=11.0.0" type="text/css" media="all">
<link rel="stylesheet" id="onepress-bootstrap-css" href="https://dbatools.io/wp-content/themes/onepress-master/assets/css/bootstrap.min.css?ver=11.0.0" type="text/css" media="all">
<link rel="stylesheet" id="onepress-style-css" href="https://dbatools.io/wp-content/plugins/onepress-plus/style.css?ver=10.1.8" type="text/css" media="all">
<style id="onepress-style-inline-css" type="text/css">
#main .video-section section.hero-slideshow-wrapper{background:transparent}.hero-slideshow-wrapper:after{position:absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(1,36,86,1);display:block;content:""}.body-desktop .parallax-hero .hero-slideshow-wrapper:after{display:none!important}.parallax-hero .parallax-mirror:after{position:absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(1,36,86,1);display:block;content:""}.body-desktop .parallax-hero .hero-slideshow-wrapper:after{display:none!important}.parallax-hero .parallax-mirror:after{position:absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(1,36,86,1);display:block;content:""}a,.screen-reader-text:hover,.screen-reader-text:active,.screen-reader-text:focus,.header-social a,.onepress-menu a:hover,.onepress-menu ul li a:hover,.onepress-menu li.onepress-current-item>a,.onepress-menu ul li.current-menu-item>a,.onepress-menu>li a.menu-actived,.onepress-menu.onepress-menu-mobile li.onepress-current-item>a,.site-footer a,.site-footer .footer-social a:hover,.site-footer .btt a:hover,.highlight,#comments .comment .comment-wrapper .comment-meta .comment-time:hover,#comments .comment .comment-wrapper .comment-meta .comment-reply-link:hover,#comments .comment .comment-wrapper .comment-meta .comment-edit-link:hover,.btn-theme-primary-outline,.sidebar .widget a:hover,.section-services .service-item .service-image i,.counter_item .counter__number,.team-member .member-thumb .member-profile a:hover,.icon-background-default{color:#012456}input[type="reset"],input[type="submit"],input[type="submit"],.nav-links a:hover,.btn-theme-primary,.btn-theme-primary-outline:hover,.card-theme-primary,.woocommerce #respond input#submit,.woocommerce a.button,.woocommerce button.button,.woocommerce input.button,.woocommerce button.button.alt{background:#012456}.btn-theme-primary-outline,.btn-theme-primary-outline:hover,.pricing__item:hover,.card-theme-primary,.entry-content blockquote{border-color:#012456}.site-header{background:#e3e3e3;border-bottom:0px none}.onepress-menu>li>a{color:#293955}.onepress-menu>li>a:hover,.onepress-menu>li.onepress-current-item>a{color:#444444;-webkit-transition:all 0.5s ease-in-out;-moz-transition:all 0.5s ease-in-out;-o-transition:all 0.5s ease-in-out;transition:all 0.5s ease-in-out}#nav-toggle span,#nav-toggle span::before,#nav-toggle span::after,#nav-toggle.nav-is-visible span::before,#nav-toggle.nav-is-visible span::after{background:#293955}.site-footer{background-color:#012456}.site-footer .footer-connect .follow-heading{color:rgba(255,255,255,0.9)}.site-footer .site-info,.site-footer .btt a{background-color:#545454}.site-footer .site-info{color:rgba(255,255,255,0.7)}.site-footer .btt a,.site-footer .site-info a{color:rgba(255,255,255,0.9)}.gallery-carousel .g-item{padding:0px 10px}.gallery-carousel{margin-left:-10px;margin-right:-10px}.gallery-grid .g-item,.gallery-masonry .g-item .inner{padding:10px}.gallery-grid,.gallery-masonry{margin:-10px}
/* --- Begin custom CSS --- */
.section-testimonials .card { max-width : 140px; }
/* --- End custom CSS --- */

 .section-features{ background-color: rgba(227,227,227,1); } 
 
</style>
<link rel="stylesheet" id="onepress-gallery-lightgallery-css" href="https://dbatools.io/wp-content/themes/onepress-master/assets/css/lightgallery.css?ver=5.3.4" type="text/css" media="all">
<link rel="stylesheet" id="upw_theme_standard-css" href="https://dbatools.io/wp-content/plugins/ultimate-posts-widget/css/upw-theme-standard.min.css?ver=5.3.4" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-official-css" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" type="text/css" media="all" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
<link rel="stylesheet" id="onepress-child-style-css" href="https://dbatools.io/wp-content/themes/onepress/style.css?ver=5.3.4" type="text/css" media="all">
<link rel="stylesheet" id="sccss_style-css" href="https://dbatools.io/?sccss=1&amp;ver=5.3.4" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-official-v4shim-css" href="https://use.fontawesome.com/releases/v5.11.2/css/v4-shims.css" type="text/css" media="all" integrity="sha384-/EdpJd7d6gGFiQ/vhh7iOjiZdf4+6K4al/XrX6FxxZwDSrAdWxAynr4p/EA/vyPQ" crossorigin="anonymous">
<style id="font-awesome-official-v4shim-inline-css" type="text/css">
@font-face {
font-family: "FontAwesome";
src: url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.eot"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.eot?#iefix") format("embedded-opentype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.woff2") format("woff2"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.woff") format("woff"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.ttf") format("truetype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-brands-400.svg#fontawesome") format("svg");
}

@font-face {
font-family: "FontAwesome";
src: url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.eot"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.eot?#iefix") format("embedded-opentype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.woff2") format("woff2"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.woff") format("woff"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.ttf") format("truetype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-solid-900.svg#fontawesome") format("svg");
}

@font-face {
font-family: "FontAwesome";
src: url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.eot"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.eot?#iefix") format("embedded-opentype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.woff2") format("woff2"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.woff") format("woff"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.ttf") format("truetype"),
		url("https://use.fontawesome.com/releases/v5.11.2/webfonts/fa-regular-400.svg#fontawesome") format("svg");
unicode-range: U+F004-F005,U+F007,U+F017,U+F022,U+F024,U+F02E,U+F03E,U+F044,U+F057-F059,U+F06E,U+F070,U+F075,U+F07B-F07C,U+F080,U+F086,U+F089,U+F094,U+F09D,U+F0A0,U+F0A4-F0A7,U+F0C5,U+F0C7-F0C8,U+F0E0,U+F0EB,U+F0F3,U+F0F8,U+F0FE,U+F111,U+F118-F11A,U+F11C,U+F133,U+F144,U+F146,U+F14A,U+F14D-F14E,U+F150-F152,U+F15B-F15C,U+F164-F165,U+F185-F186,U+F191-F192,U+F1AD,U+F1C1-F1C9,U+F1CD,U+F1D8,U+F1E3,U+F1EA,U+F1F6,U+F1F9,U+F20A,U+F247-F249,U+F24D,U+F254-F25B,U+F25D,U+F267,U+F271-F274,U+F279,U+F28B,U+F28D,U+F2B5-F2B6,U+F2B9,U+F2BB,U+F2BD,U+F2C1-F2C2,U+F2D0,U+F2D2,U+F2DC,U+F2ED,U+F328,U+F358-F35B,U+F3A5,U+F3D1,U+F410,U+F4AD;
}
</style>
<link rel="stylesheet" id="jetpack_css-css" href="https://c0.wp.com/p/jetpack/8.4.2/css/jetpack.css" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var onepress_js_settings = {"onepress_disable_animation":"1","onepress_disable_sticky_header":"1","onepress_vertical_align_menu":"0","hero_animation":"flipInX","hero_speed":"5000000","is_home":"","gallery_enable":"1"};
var OnePress_Plus = {"ajax_url":"https:\/\/dbatools.io\/wp-admin\/admin-ajax.php","browser_warning":" Your browser does not support the video tag. I suggest you upgrade your browser."};
/* ]]> */
</script>
<script type="text/javascript" src="https://c0.wp.com/c/5.3.4/wp-includes/js/jquery/jquery.js"></script>
<script type="text/javascript" src="https://c0.wp.com/c/5.3.4/wp-includes/js/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="text/javascript" src="https://c0.wp.com/p/jetpack/8.4.2/_inc/build/related-posts/related-posts.min.js"></script>


<link rel="prev" title="30 day countdown to 1.0 starts today!" href="https://dbatools.io/30-day-countdown-to-1-0-starts-today/">
<link rel="next" title="dbatools 1.0 has arrived &#127881;" href="https://dbatools.io/dbatools10/">


<link rel="alternate" type="application/json+oembed" href="https://dbatools.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdbatools.io%2Fkeeping-availability-group-logins-in-sync-automatically%2F">
<link rel="alternate" type="text/xml+oembed" href="https://dbatools.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fdbatools.io%2Fkeeping-availability-group-logins-in-sync-automatically%2F&amp;format=xml">

<link rel="dns-prefetch" href="//v0.wordpress.com">
<link rel="dns-prefetch" href="//widgets.wp.com">
<link rel="dns-prefetch" href="//s0.wp.com">
<link rel="dns-prefetch" href="//0.gravatar.com">
<link rel="dns-prefetch" href="//1.gravatar.com">
<link rel="dns-prefetch" href="//2.gravatar.com">
<link rel="dns-prefetch" href="//i0.wp.com">
<link rel="dns-prefetch" href="//i1.wp.com">
<link rel="dns-prefetch" href="//i2.wp.com">
<link rel="dns-prefetch" href="//c0.wp.com">
<link rel="dns-prefetch" href="//jetpack.wordpress.com">
<link rel="dns-prefetch" href="//s1.wp.com">
<link rel="dns-prefetch" href="//s2.wp.com">
<link rel="dns-prefetch" href="//public-api.wordpress.com">
<style type="text/css">img#wpstats{display:none}</style><link rel="canonical" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/">
			<style type="text/css">
				/* If html does not have either class, do not show lazy loaded images. */
				html:not( .jetpack-lazy-images-js-enabled ):not( .js ) .jetpack-lazy-image {
					display: none;
				}
			</style>
			<script>
				document.documentElement.classList.add(
					'jetpack-lazy-images-js-enabled'
				);
			</script>
		

<meta property="og:type" content="article">
<meta property="og:title" content="keeping availability group logins in sync automatically">
<meta property="og:url" content="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/">
<meta property="og:description" content="I am Andreas Schubert and I am working as a Principal Consultant and Database Reliability Engineer for SQL Server &amp; Azure for multiple national and international companies. My focus is on imple&hellip;">
<meta property="article:published_time" content="2019-05-20T19:14:11+00:00">
<meta property="article:modified_time" content="2019-06-16T12:59:50+00:00">
<meta property="og:site_name" content="dbatools">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">
<meta name="twitter:text:title" content="keeping availability group logins in sync automatically">
<meta name="twitter:image" content="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools.png?fit=128%2C128&amp;ssl=1">
<meta name="twitter:card" content="summary">


<link rel="icon" href="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools.png?fit=32%2C32&amp;ssl=1" sizes="32x32">
<link rel="icon" href="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools.png?fit=128%2C128&amp;ssl=1" sizes="192x192">
<link rel="apple-touch-icon-precomposed" href="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools.png?fit=128%2C128&amp;ssl=1">
<meta name="msapplication-TileImage" content="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools.png?fit=128%2C128&amp;ssl=1">

<style class="wp-typography-print-styles" type="text/css">
body, body p { 
	font-style: normal;
	text-transform: none;
 } 
 .onepress-menu a { 
	font-style: normal;
	text-transform: none;
 } 
 body h1, body h2, body h3, body h4, body h5, body h6,
    body .section-title-area .section-title, body .section-title-area .section-subtitle, body .hero-content-style1 h2 { 
	font-style: normal;
	text-transform: none;
 }
</style>
			<style type="text/css" id="wp-custom-css">
				/*
Welcome to Custom CSS!

To learn how this works, see http://wp.me/PEmnE-Bt
*/			</style>
		</head>

<body class="post-template-default single single-post postid-9655 single-format-standard wp-custom-logo group-blog no-sticky-header">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
            <header id="masthead" class="site-header" role="banner">
            <div class="container">
                <div class="site-branding">
                <div class="site-brand-inner has-logo-img no-desc"><div class="site-logo-div"><a href="https://dbatools.io/" class="custom-logo-link" rel="home"><img width="223" height="64" src="https://i0.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools-logo-1.png?fit=223%2C64&amp;ssl=1" class="custom-logo jetpack-lazy-image" alt="dbatools" data-lazy-src="https://i0.wp.com/dbatools.io/wp-content/uploads/2016/05/dbatools-logo-1.png?fit=223%2C64&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "></a></div></div>                </div>
                

                <div class="header-right-wrapper">
                    <a href="#0" id="nav-toggle">Menu<span></span></a>
                    <nav id="site-navigation" class="main-navigation" role="navigation">
                        <ul class="onepress-menu">
                            <li id="menu-item-1452" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1452"><a href="https://dbatools.io/download/">&#11015; download</a>
<ul class="sub-menu">
	<li id="menu-item-1451" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1451"><a href="https://dbatools.io/getting-started/">get started</a></li>
</ul>
</li>
<li id="menu-item-1453" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1453"><a href="https://dbatools.io/commands/">&#128640; commands</a></li>
<li id="menu-item-8268" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-8268"><a href="https://dbatools.io/docs">&#128209; docs</a>
<ul class="sub-menu">
	<li id="menu-item-8270" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8270"><a href="https://dbatools.io/blog">blog</a></li>
</ul>
</li>
<li id="menu-item-1456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1456"><a href="https://dbatools.io/team/">&#129395; team</a>
<ul class="sub-menu">
	<li id="menu-item-3315" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3315"><a href="https://dbatools.io/contributing">contribute</a></li>
	<li id="menu-item-3123" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3123"><a href="https://dbatools.io/contact/">contact</a></li>
	<li id="menu-item-3116" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-3116"><a href="https://dbatools.io/git">find us</a>
	<ul class="sub-menu">
		<li id="menu-item-4663" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4663"><a href="https://dbatools.io/slack">slack</a></li>
		<li id="menu-item-4662" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4662"><a href="https://dbatools.io/github">github</a></li>
		<li id="menu-item-4664" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4664"><a href="https://dbatools.io/twitter">twitter</a></li>
		<li id="menu-item-4665" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4665"><a href="https://dbatools.io/youtube">youtube</a></li>
		<li id="menu-item-4666" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4666"><a href="https://dbatools.io/linkedin">linkedin</a></li>
	</ul>
</li>
</ul>
</li>
<li id="menu-item-3340" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3340"><a href="https://dbatools.io/subscribe/">&#128140; subscribe</a></li>
<li id="menu-item-6587" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6587"><a href="https://dbatools.io/builds">&#10004; build ref</a></li>
<li id="menu-item-9781" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9781"><a href="https://dbatools.io/sponsorship/">&#128149; sponsor</a></li>
<li id="menu-item-9994" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9994"><a href="https://dbatools.io/book">&#128216; book</a></li>
                        </ul>
                    </nav>
                    
                </div>
            </div>
        </header>
        
	<div id="content" class="site-content">

		
		<div id="content-inside" class="container right-sidebar">
			<div id="primary" class="content-area">
				<main id="main" class="site-main" role="main">

				
					
<article id="post-9655" class="post-9655 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements">
	<header class="entry-header">
		<h1 class="entry-title">keeping availability group logins in sync automatically</h1>
		<div class="entry-meta">
			<span class="posted-on">Posted on <a href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/" rel="bookmark"><time class="entry-date published" datetime="2019-05-20T19:14:11+00:00">May 20, 2019</time><time class="updated hide" datetime="2019-06-16T12:59:50+00:00">June 16, 2019</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://dbatools.io/author/andreas/">Andreas</a></span></span>		</div>
	</header>

	<div class="entry-content">
		<p>I am Andreas Schubert and I am working as a Principal Consultant and Database Reliability Engineer for SQL Server &amp; Azure for multiple national and international companies. My focus is on implementing and operating complex 24/7 SQL environments with tens and hundreds of servers and multi-terabyte databases.</p>
<p>Welcome to a quick post that should help you operate your SQL Server environment more consistently and reduce manual, repetitive work.</p>
<h2>The Problem</h2>
<p>When you are running SQL Server Availability Groups, one of the most cumbersome tasks is to ensure that all logins are synchronised between all replicas. While not exactly rocket science, it is something that quickly means a lot of work if you are managing more than one or two Availability Groups.<br>
Wouldn&rsquo;t it be nice to have a script that is flexible enough to</p>
<ul>
<li>be called by only specifying the Availability Group Listener</li>
<li>detect all replicas and their roles automatically</li>
<li>connect to the primary, read all SQL logins and apply them to EVERY secondary automatically?</li>
</ul>
<p>Well,&nbsp;dbatools to the rescue again.</p>
<h2>The solution</h2>
<p>With dbatools, such a routine takes only a few lines of code.<br>
The below script connects to the Availability Group Listener, queries it to get the current primary replica, as well as every secondary replica and then synchronizes all logins to each secondary.</p>
<p>In the template code, no changes are actually written due to the -WhatIf switch, so that you can safely test it to see what changes would be committed.</p>
<pre class="lang:ps decode:true " title="SyncLoginsToReplica.ps1">&lt;#
    Script : SyncLoginsToReplica.ps1
    Author : Andreas Schubert (http://www.linkedin.com/in/schubertandreas)
    Purpose: Sync logins between all replicas in an Availability Group automatically.
    --------------------------------------------------------------------------------------------
    The script will connect to the listener name of the Availability Group
    and read all replica instances to determine the current primary replica and all secondaries.
    It will then connect directly to the current primary, query all Logins and create them on each
    secondary.
    
    Attention:
    The script is provided so that no action is actually executed against the secondaries (switch -WhatIf).
    Change that line according to your logic, you might want to exclude other logins or decide to not drop
        any existing ones.
    --------------------------------------------------------------------------------------------
    Usage: Save the script in your file system, change the name of the AG Listener (AGListenerName in this template) 
           and schedule it to run at your prefered schedule. I usually sync logins once per hour, although 
           on more volatile environments it may run as often as every minute
#&gt;

# define the AG name
    $AvailabilityGroupName = 'AGListenerName'

# internal variables
    $ClientName = 'AG Login Sync helper'
    $primaryInstance = $null
    $secondaryInstances = @{}


try {
    # connect to the AG listener, get the name of the primary and all secondaries
        $replicas = Get-DbaAgReplica -SqlInstance $AvailabilityGroupName 
        $primaryInstance = $replicas | Where Role -eq Primary | select -ExpandProperty name
        $secondaryInstances = $replicas | Where Role -ne Primary | select -ExpandProperty name
    # create a connection object to the primary
        $primaryInstanceConnection = Connect-DbaInstance $primaryInstance -ClientName $ClientName
    # loop through each secondary replica and sync the logins
        $secondaryInstances | ForEach-Object {
            $secondaryInstanceConnection = Connect-DbaInstance $_ -ClientName $ClientName
            Copy-DbaLogin -Source $primaryInstanceConnection -Destination $secondaryInstanceConnection -ExcludeSystemLogins -WhatIf
        }
}
catch {
    $msg = $_.Exception.Message
    Write-Error "Error while syncing logins for Availability Group '$($AvailabilityGroupName): $msg'"
}
</pre>
<p>To make tools reusable, you could easily turn this script into a function by adding the 2 variables as parameters. Then you could call it from any other script like</p>
<pre class="lang:ps decode:true ">SyncLoginsToReplica.ps1 -AvailabilityGroupName YourAGListenerName -ClientName "Client"</pre>
<p>For simplicity, I created this as a standalone script though.</p>
<p>I hope you find this post useful. For questions and remarks please feel free to <a href="http://www.linkedin.com/in/schubertandreas">message me</a>!</p>

<div id="jp-relatedposts" class="jp-relatedposts">
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>			</div>

	<footer class="entry-footer">
			</footer>
</article>


					
<div id="comments" class="comments-area">

	
			<h3 class="comments-title">
			26 thoughts on &ldquo;<span>keeping availability group logins in sync automatically</span>&rdquo;		</h3>

		
		<ol class="comment-list">
			    <li class="comment even thread-even depth-1" id="li-comment-65855">
        <article id="comment-65855" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/1a3e304860e301735b34b9ccca73c44b?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/1a3e304860e301735b34b9ccca73c44b?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/1a3e304860e301735b34b9ccca73c44b?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/1a3e304860e301735b34b9ccca73c44b?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a3e304860e301735b34b9ccca73c44b?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Itzik</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65855"><time datetime="2019-05-20T19:45:16+00:00">May 20, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65855#respond" data-commentid="65855" data-postid="9655" data-belowelement="comment-65855" data-respondelement="respond" aria-label="Reply to Itzik">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Great one</p>
                                    </div>

            </div>

        </article>
    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-65880">
        <article id="comment-65880" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/ff150321310a91f2b4333dec7fe3deea?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/ff150321310a91f2b4333dec7fe3deea?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/ff150321310a91f2b4333dec7fe3deea?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/ff150321310a91f2b4333dec7fe3deea?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/ff150321310a91f2b4333dec7fe3deea?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Dani</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65880"><time datetime="2019-05-21T05:52:29+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65880#respond" data-commentid="65880" data-postid="9655" data-belowelement="comment-65880" data-respondelement="respond" aria-label="Reply to Dani">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Thanks! Just what I was looking for!!</p>
                                    </div>

            </div>

        </article>
    </li>
    <li class="comment even thread-even depth-1" id="li-comment-65902">
        <article id="comment-65902" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/e9f48ed27456bcdeb961ecf4f03840dd?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/e9f48ed27456bcdeb961ecf4f03840dd?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/e9f48ed27456bcdeb961ecf4f03840dd?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/e9f48ed27456bcdeb961ecf4f03840dd?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/e9f48ed27456bcdeb961ecf4f03840dd?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Don Boutwell</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65902"><time datetime="2019-05-21T14:15:06+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65902#respond" data-commentid="65902" data-postid="9655" data-belowelement="comment-65902" data-respondelement="respond" aria-label="Reply to Don Boutwell">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Does this copy the passwords for the local sql logins as well, or will they still need to be &ldquo;reset&rdquo; once the sync is performed?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor odd alt depth-2" id="li-comment-65903">
        <article id="comment-65903" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65903"><time datetime="2019-05-21T14:27:00+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65903#respond" data-commentid="65903" data-postid="9655" data-belowelement="comment-65903" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>It does not detect password changes, but a login copied from source to destination will have the correct password</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment even thread-odd thread-alt depth-1" id="li-comment-65904">
        <article id="comment-65904" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/37af235980a2adcf560262ff9d6df7ec?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/37af235980a2adcf560262ff9d6df7ec?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/37af235980a2adcf560262ff9d6df7ec?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/37af235980a2adcf560262ff9d6df7ec?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/37af235980a2adcf560262ff9d6df7ec?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Anthony Perkins</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65904"><time datetime="2019-05-21T14:43:08+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65904#respond" data-commentid="65904" data-postid="9655" data-belowelement="comment-65904" data-respondelement="respond" aria-label="Reply to Anthony Perkins">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Thanks, this PS script is very helpful.  </p>
<p>Incidentally, it worked flawlessly on two separate listeners, but failed on a third one with the following error (ag_aq01 is the listener name):<br>
Error while syncing logins for Availability Group &lsquo;ag_aq01: Cannot process argument transformation on parameter &lsquo;Source&rsquo;. Cannot convert value &ldquo;System.Object[]&rdquo; to type &ldquo;Sqlcollaborative.Dbatools.Parameter.DbaInstanceParameter&rdquo;. Error: &ldquo;Failed to<br>
interpret input as Instance: System.Object[]&rdquo;&lsquo;<br>
    + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorException<br>
    + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorException</p>
<p>The only difference is that this server contains more than one AG (the second AG has no listener), could that be the problem?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor odd alt depth-2" id="li-comment-65905">
        <article id="comment-65905" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65905"><time datetime="2019-05-21T15:01:18+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65905#respond" data-commentid="65905" data-postid="9655" data-belowelement="comment-65905" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Yes, that is the reason. You could work around that by adding a for each around the primary collection or add a parameter for the AG Name and pass that to the get-dbaagprimary.</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment even thread-even depth-1" id="li-comment-65916">
        <article id="comment-65916" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Lee</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65916"><time datetime="2019-05-21T18:54:10+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65916#respond" data-commentid="65916" data-postid="9655" data-belowelement="comment-65916" data-respondelement="respond" aria-label="Reply to Lee">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>I like this script.  You have a -whatif in the copy-dbalogin command.  won&rsquo;t that keep it from actually copying the logins?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor odd alt depth-2" id="li-comment-65917">
        <article id="comment-65917" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65917"><time datetime="2019-05-21T18:56:13+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65917#respond" data-commentid="65917" data-postid="9655" data-belowelement="comment-65917" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Lee, yes. I did that on purpose so that people can try it without accidentally changing their settings</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment even depth-3" id="li-comment-65918">
        <article id="comment-65918" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b51d09a85eb791d79e84e11f43ec6a4d?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Lee</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-65918"><time datetime="2019-05-21T19:03:04+00:00">May 21, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=65918#respond" data-commentid="65918" data-postid="9655" data-belowelement="comment-65918" data-respondelement="respond" aria-label="Reply to Lee">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>perfect.  just wanted to make sure i was understanding the code correctly.</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
</ul>
</li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-66277">
        <article id="comment-66277" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/d606d70a499d53d74d2bc9ed1d628a5b?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/d606d70a499d53d74d2bc9ed1d628a5b?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/d606d70a499d53d74d2bc9ed1d628a5b?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/d606d70a499d53d74d2bc9ed1d628a5b?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/d606d70a499d53d74d2bc9ed1d628a5b?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">thomas</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66277"><time datetime="2019-05-27T18:24:57+00:00">May 27, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66277#respond" data-commentid="66277" data-postid="9655" data-belowelement="comment-66277" data-respondelement="respond" aria-label="Reply to thomas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Would this work if login is removed from primary?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor even depth-2" id="li-comment-66278">
        <article id="comment-66278" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66278"><time datetime="2019-05-27T18:36:14+00:00">May 27, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66278#respond" data-commentid="66278" data-postid="9655" data-belowelement="comment-66278" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>No, the copy-dbalogin command does not check if the login exists on a secondary only. but that would be not too hard to add to the script logic. i am currently on the road and can&rsquo;t do it right now,<br>
but basically you need to do a get-dbalogin for the secondary servers, enumerate on each of the logins from the returned list and if it doesn&rsquo;t find a login on the primary (by doing a get-dbalogin -SQLinstance $primary -login $NameFromSecondary) then drop the login on the secondary by piping it to remove-dbalogin -sQLinstance $primary</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment odd alt thread-even depth-1" id="li-comment-66283">
        <article id="comment-66283" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/9f06b52e3c9f4ca1949565307521cc8a?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/9f06b52e3c9f4ca1949565307521cc8a?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/9f06b52e3c9f4ca1949565307521cc8a?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/9f06b52e3c9f4ca1949565307521cc8a?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9f06b52e3c9f4ca1949565307521cc8a?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">PS</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66283"><time datetime="2019-05-27T21:14:21+00:00">May 27, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66283#respond" data-commentid="66283" data-postid="9655" data-belowelement="comment-66283" data-respondelement="respond" aria-label="Reply to PS">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>How to skip executing the script if I am executing it on secondary replica?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor even depth-2" id="li-comment-66360">
        <article id="comment-66360" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66360"><time datetime="2019-05-29T09:34:24+00:00">May 29, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66360#respond" data-commentid="66360" data-postid="9655" data-belowelement="comment-66360" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>that&rsquo;s easy. Create a job step as the first step that checks the current status of the replica by doing master.sys.fn_hadr_is_primary_replica(&lsquo;yourDB&rsquo;). If the status is NULL or 0 then the database is either not part of an AG or not the primary replica. In that case, raise an error and finish the job at step 1. If it is the primary replica, execute the next step (syncing the logins).<br>
Or you can do it in PowerShell as well by checking $primaryInstance against $env:computername to see if you are currently running on a primary replica or not.</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-66315">
        <article id="comment-66315" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/a59ad4b47d8c7fd4cb4ae137e6d2f91a?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/a59ad4b47d8c7fd4cb4ae137e6d2f91a?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/a59ad4b47d8c7fd4cb4ae137e6d2f91a?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/a59ad4b47d8c7fd4cb4ae137e6d2f91a?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a59ad4b47d8c7fd4cb4ae137e6d2f91a?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Kin Shah</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66315"><time datetime="2019-05-28T14:17:15+00:00">May 28, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66315#respond" data-commentid="66315" data-postid="9655" data-belowelement="comment-66315" data-respondelement="respond" aria-label="Reply to Kin Shah">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Great blog post ! I guess  Sync-DbaAvailabilityGroup `https://docs.dbatools.io/#Sync-DbaAvailabilityGroup` will cover a bigger umbrella &ndash; logins, login permissions, dbmail, proxy, linkedservers, etc</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor even depth-2" id="li-comment-66359">
        <article id="comment-66359" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66359"><time datetime="2019-05-29T09:28:17+00:00">May 29, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66359#respond" data-commentid="66359" data-postid="9655" data-belowelement="comment-66359" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Thanks Kin,<br>
sync-dbaAvailabilityGroup is really great for an initial sync (when you create the AG and need to set up all replicas). Further down the road I don&rsquo;t want configuration changes to automatically be applied to any replicas automatically. Logins change frequently and need to be kept in sync, but sp_configure options and Credentials, DatabaseMail, LinkedServers etc. are deployed following certain processes (hopefully), so that I tend to exclude those from automated jobs.</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment odd alt thread-even depth-1" id="li-comment-66381">
        <article id="comment-66381" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/cc40167a97f1559a1436aa04b573d425?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/cc40167a97f1559a1436aa04b573d425?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/cc40167a97f1559a1436aa04b573d425?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/cc40167a97f1559a1436aa04b573d425?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/cc40167a97f1559a1436aa04b573d425?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Michael Kirkpatrick</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66381"><time datetime="2019-05-29T16:18:39+00:00">May 29, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66381#respond" data-commentid="66381" data-postid="9655" data-belowelement="comment-66381" data-respondelement="respond" aria-label="Reply to Michael Kirkpatrick">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Any chance you might update the script to handle instances with multiple AGs?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor even depth-2" id="li-comment-66382">
        <article id="comment-66382" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66382"><time datetime="2019-05-29T16:22:02+00:00">May 29, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66382#respond" data-commentid="66382" data-postid="9655" data-belowelement="comment-66382" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Michael,</p>
<p>I don&rsquo;t think that will happen soon. The reason is that I&rsquo;d like to test code thoroughly before I put it up for public. I don&rsquo;t do multi-AG instances and so I won&rsquo;t be able to test it.</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-66442">
        <article id="comment-66442" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/83c18e49de9b7ae4a9a1e92863fb7fe1?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/83c18e49de9b7ae4a9a1e92863fb7fe1?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/83c18e49de9b7ae4a9a1e92863fb7fe1?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/83c18e49de9b7ae4a9a1e92863fb7fe1?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/83c18e49de9b7ae4a9a1e92863fb7fe1?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Pasquale Ceglie</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66442"><time datetime="2019-05-30T16:39:33+00:00">May 30, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66442#respond" data-commentid="66442" data-postid="9655" data-belowelement="comment-66442" data-respondelement="respond" aria-label="Reply to Pasquale Ceglie">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hi Andreas, any suggestion about this error? I&rsquo;m struggling with this one.</p>
<p>Login &ndash; WindowsUser mydomain\myuser Successful<br>
Exception calling &ldquo;EnumServerPermissions&rdquo; with &ldquo;1&rdquo; argument(s): &ldquo;There is<br>
already an open DataReader associated with this Command which must be closed<br>
first.&rdquo;<br>
At line:114615 char:9<br>
+         $perms = $SourceServer.EnumServerPermissions($userName)<br>
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException<br>
    + FullyQualifiedErrorId : InvalidOperationException</p>
<p>The following exception occurred while trying to enumerate the collection:<br>
&ldquo;There is already an open DataReader associated with this Command which must<br>
be closed first.&rdquo;.<br>
At line:114664 char:9<br>
+         $loginCredentials = $SourceServer.Credentials | Where-Object  &hellip;<br>
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
    + CategoryInfo          : NotSpecified: (:) [], ExtendedTypeSystemExceptio<br>
   n<br>
    + FullyQualifiedErrorId : ExceptionInGetEnumerator</p>
<p>Exception calling &ldquo;EnumDatabaseMappings&rdquo; with &ldquo;0&rdquo; argument(s): &ldquo;Enumerate<br>
database mappings failed for Login &lsquo;mydomain\myuser&rsquo;. &rdquo;<br>
At line:114772 char:21<br>
+     foreach ($db in $SourceLogin.EnumDatabaseMappings()) {<br>
+                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException<br>
    + FullyQualifiedErrorId : FailedOperationException</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment byuser comment-author-andreas bypostauthor even depth-2" id="li-comment-66445">
        <article id="comment-66445" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn"><a href="http://www.linkedin.com/in/schubertandreas" rel="external nofollow ugc" class="url">Andreas</a></b> <span>Post author</span></cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-66445"><time datetime="2019-05-30T16:59:37+00:00">May 30, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=66445#respond" data-commentid="66445" data-postid="9655" data-belowelement="comment-66445" data-respondelement="respond" aria-label="Reply to Andreas">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hi Pasquale,</p>
<p>I have a hunch that you may be having many Logins on your primary replica with many explicit permissions. I&rsquo;ve seen that once on another project that had nothing to do with dbatools and what I did back then was changing my code to use a longer timeout when querying the permissions &ndash; that did the trick for me. But it won&rsquo;t be as easy here, since the exception is raised in one of the lower level functions of sync-dbalogin. Can you raise a bug report on dbatools?</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment odd alt depth-3" id="li-comment-75118">
        <article id="comment-75118" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/2e300eab9766054cdf39152655942b3c?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/2e300eab9766054cdf39152655942b3c?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/2e300eab9766054cdf39152655942b3c?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/2e300eab9766054cdf39152655942b3c?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2e300eab9766054cdf39152655942b3c?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Dennis</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-75118"><time datetime="2019-10-07T21:57:13+00:00">October 7, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=75118#respond" data-commentid="75118" data-postid="9655" data-belowelement="comment-75118" data-respondelement="respond" aria-label="Reply to Dennis">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>My parameterized and support for multiple AGs on a single listener (requires listener and AG name to be provided) and still contains the -whatif:</p>
<p> param (<br>
# define the AG name<br>
    [Parameter(Mandatory=$true)][string]$AvailabilityGroupName,<br>
    [Parameter(Mandatory=$true)][string]$AvailabilityGroupListener,<br>
    [string]$ClientName = &lsquo;AG Login Sync helper&rsquo;</p>
<p> )<br>
# internal variables<br>
    #$ClientName = &lsquo;AG Login Sync helper&rsquo;<br>
    $primaryInstance = $null<br>
    $secondaryInstances = @{}</p>
<p>try {<br>
    # connect to the AG listener, get the name of the primary and all secondaries<br>
        $replicas = Get-DbaAgReplica -SqlInstance $AvailabilityGroupListener -AvailabilityGroup $AvailabilityGroupName<br>
        $primaryInstance = $replicas | Where Role -eq Primary | select -ExpandProperty name<br>
        $secondaryInstances = $replicas | Where Role -ne Primary | select -ExpandProperty name<br>
    # create a connection object to the primary<br>
        $primaryInstanceConnection = Connect-DbaInstance $primaryInstance -ClientName $ClientName<br>
    # loop through each secondary replica and sync the logins<br>
        $secondaryInstances | ForEach-Object {<br>
            $secondaryInstanceConnection = Connect-DbaInstance $_ -ClientName $ClientName<br>
            Copy-DbaLogin -Source $primaryInstanceConnection -Destination $secondaryInstanceConnection -ExcludeSystemLogins -WhatIf<br>
        }<br>
}<br>
catch {<br>
    $msg = $_.Exception.Message<br>
    Write-Error &ldquo;Error while syncing logins for Availability Group &lsquo;$($AvailabilityGroupName): $msg'&rdquo;<br>
}</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
</ul>
</li>
    <li class="comment even thread-even depth-1" id="li-comment-75629">
        <article id="comment-75629" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/11d6adc12ae0245f202eff0f9707d447?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/11d6adc12ae0245f202eff0f9707d447?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/11d6adc12ae0245f202eff0f9707d447?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/11d6adc12ae0245f202eff0f9707d447?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/11d6adc12ae0245f202eff0f9707d447?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Alex</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-75629"><time datetime="2019-10-16T13:59:51+00:00">October 16, 2019</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=75629#respond" data-commentid="75629" data-postid="9655" data-belowelement="comment-75629" data-respondelement="respond" aria-label="Reply to Alex">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>I have just tried this solution and it works great, however, when the login fails to copy over it doesn&rsquo;t give me a reason for failure? Is there any way that i can get that information so that I can fix it?</p>
                                    </div>

            </div>

        </article>
    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-78367">
        <article id="comment-78367" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/9e45a752c9e13362dc54f315843e095f?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/9e45a752c9e13362dc54f315843e095f?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/9e45a752c9e13362dc54f315843e095f?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/9e45a752c9e13362dc54f315843e095f?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/9e45a752c9e13362dc54f315843e095f?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Marty</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-78367"><time datetime="2020-01-01T12:23:57+00:00">January 1, 2020</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=78367#respond" data-commentid="78367" data-postid="9655" data-belowelement="comment-78367" data-respondelement="respond" aria-label="Reply to Marty">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hi Andreas, nice script. Works well after a little adjustment. I had to put the name of the listener in the code as the sqlinstance. If I did not put in the name of the sqlinstance, I got an error stating that the network path was not found. But now I do get a Windows credentials popup with the name of the availabilitygroupname as the user. If I cancel the popup the script continues perfectly. Any idea why this popup shows up? I do get it on the SQL machines and on a workstation that I normally use.</p>
                                    </div>

            </div>

        </article>
    </li>
    <li class="comment even thread-even depth-1" id="li-comment-80008">
        <article id="comment-80008" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Anil</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-80008"><time datetime="2020-04-06T12:52:32+00:00">April 6, 2020</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=80008#respond" data-commentid="80008" data-postid="9655" data-belowelement="comment-80008" data-respondelement="respond" aria-label="Reply to Anil">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hello<br>
Great script when I run in powershell window it is okay but as a SQL jobs result is failed. It is on SQL 2019 HA Developer Edition<br>
Any advise?<br>
Anil</p>
                                    </div>

            </div>

        </article>
    </li>
    <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-80068">
        <article id="comment-80068" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7add77da09816012f34497c500c78062?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">andreasschubert2019</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-80068"><time datetime="2020-04-10T10:05:09+00:00">April 10, 2020</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=80068#respond" data-commentid="80068" data-postid="9655" data-belowelement="comment-80068" data-respondelement="respond" aria-label="Reply to andreasschubert2019">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Anil, a bit more detail on what error you are getting would be helpful. My gut feeling: you are running the agent job via an account with not enough permissions</p>
                                    </div>

            </div>

        </article>
    <ul class="children">
    <li class="comment even depth-2" id="li-comment-80155">
        <article id="comment-80155" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c6a605ed8a5f256a94d95b3faf22eb5c?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Anil</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-80155"><time datetime="2020-04-14T08:43:11+00:00">April 14, 2020</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=80155#respond" data-commentid="80155" data-postid="9655" data-belowelement="comment-80155" data-respondelement="respond" aria-label="Reply to Anil">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hello , Many thanks for the reply. Please find below the output of the job. If I copy the syntax in Powershell it works. the syntax is &rdquo; C:\Windows\System32\WindowsPowerShell\v1.0\PowerShell.exe  -Command &ldquo;Copy-DbaLogin -Source SVWDC2TSQL2 -Destination SVWDC1TSQL2&Prime; &rdquo;<br>
Login WindowsUser  NGH-AD\XXXXX_Admin      Failed<br>
Login &ndash; WindowsUser  NGH-AD\GuptaA_Admin         Failed<br>
Login &ndash; WindowsUser  NGH-AD\svcCDTSQL2$          Skipped Current<br>
Login &ndash; WindowsUser  NGH-AD\Backup_Service<br>
Login &ndash; SqlLogin     RFID_admin                  Failed</p>
<p>Any help will be much appreciated<br>
Regards<br>
Anil</p>
                                    </div>

            </div>

        </article>
    </li>
</ul>
</li>
    <li class="comment odd alt thread-even depth-1" id="li-comment-80650">
        <article id="comment-80650" class="comment clearfix">

            <img alt src="https://secure.gravatar.com/avatar/1a276de5d579e6879f34c98f936cfc31?s=60&amp;d=mm&amp;r=g" class="avatar avatar-60 photo jetpack-lazy-image" height="60" width="60" data-lazy-srcset="https://secure.gravatar.com/avatar/1a276de5d579e6879f34c98f936cfc31?s=120&amp;d=mm&amp;r=g 2x" data-lazy-src="https://secure.gravatar.com/avatar/1a276de5d579e6879f34c98f936cfc31?s=60&amp;is-pending-load=1#038;d=mm&amp;r=g" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "><noscript><img alt="" src="https://secure.gravatar.com/avatar/1a276de5d579e6879f34c98f936cfc31?s=60&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/1a276de5d579e6879f34c98f936cfc31?s=120&amp;d=mm&amp;r=g 2x" class="avatar avatar-60 photo" height="60" width="60"></noscript>
            <div class="comment-wrapper">

                <header class="comment-meta comment-author vcard">
                    <cite><b class="fn">Fred Sanders</b> </cite><a class="comment-time" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#comment-80650"><time datetime="2020-05-11T22:14:32+00:00">May 11, 2020</time></a><a rel="nofollow" class="comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/?replytocom=80650#respond" data-commentid="80650" data-postid="9655" data-belowelement="comment-80650" data-respondelement="respond" aria-label="Reply to Fred Sanders">Reply</a>                </header>

                
                <div class="comment-content entry-content">
                    <p>Hi Andreas,</p>
<p>I am very happy with this script. However, how could I go about logging the results of Copy-DBALogin to a file?  I have tried a couple variations of start-transcript to no avail.</p>
                                    </div>

            </div>

        </article>
    </li>
		</ol>

		
	
	
	
		<div id="respond" class="comment-respond">
							<h3 id="reply-title" class="comment-reply-title">Leave a Reply					<small><a rel="nofollow" id="cancel-comment-reply-link" href="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/#respond" style="display:none;">Cancel reply</a></small>
				</h3>
						<form id="commentform" class="comment-form">
				<iframe title="Comment Form" src="https://jetpack.wordpress.com/jetpack-comment/?blogid=111052036&amp;postid=9655&amp;comment_registration=0&amp;require_name_email=1&amp;stc_enabled=1&amp;stb_enabled=1&amp;show_avatars=1&amp;avatar_default=mystery&amp;greeting=Leave+a+Reply&amp;greeting_reply=Leave+a+Reply+to+%25s&amp;color_scheme=light&amp;lang=en_US&amp;jetpack_version=8.4.2&amp;show_cookie_consent=10&amp;has_cookie_consent=0&amp;token_key=%3Bnormal%3B&amp;sig=d1719adfeb1ac588e6735195a2eed5b73228e355#parent=https%3A%2F%2Fdbatools.io%2Fkeeping-availability-group-logins-in-sync-automatically%2F" style="width:100%; height: 430px; border:0;" name="jetpack_remote_comment" class="jetpack_remote_comment" id="jetpack_remote_comment" sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups"></iframe>
									
					<script>
						document.addEventListener('DOMContentLoaded', function () {
							var commentForms = document.getElementsByClassName('jetpack_remote_comment');
							for (var i = 0; i < commentForms.length; i++) {
								commentForms[i].allowTransparency = false;
								commentForms[i].scrolling = 'no';
							}
						});
					</script>
					
							</form>
		</div>

		
		<input type="hidden" name="comment_parent" id="comment_parent" value="">

		<p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div>

				
				</main>
			</div>

                            
<div id="secondary" class="widget-area sidebar" role="complementary">
	<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://dbatools.io/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s">
				</label>
				<input type="submit" class="search-submit" value="Search">
			</form></aside><aside id="custom_html-3" class="widget_text widget widget_custom_html"><h2 class="widget-title">new book</h2><div class="textwidget custom-html-widget">dbatools in a month of lunches is now available in Manning's Early Access Program &#128640; <br>&nbsp;

<p align="center"><a href="https://dbatools.io/book"><img alt="dbatools meap" src="https://i2.wp.com/blog.netnerds.net/wp-content/uploads/2019/08/meap.png?w=800&amp;ssl=1" data-recalc-dims="1" data-lazy-src="https://i2.wp.com/blog.netnerds.net/wp-content/uploads/2019/08/meap.png?w=800&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " class=" jetpack-lazy-image"><noscript><img alt="dbatools meap" src="https://i2.wp.com/blog.netnerds.net/wp-content/uploads/2019/08/meap.png?w=800&amp;ssl=1" data-recalc-dims="1"></noscript></a></p>

Get the book now at <a href="https://dbatools.io/book">manning.com</a></div></aside><aside id="sticky-posts-2" class="widget widget_ultimate_posts"><h2 class="widget-title"><a href="https://dbatools.io/blog">posts</a></h2>

<div class="upw-posts hfeed">

  
      
        
        <article class="post-10008 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/aliases/" rel="bookmark">
                  <img width="300" height="155" src="https://i2.wp.com/dbatools.io/wp-content/uploads/2020/01/cli12a.png?fit=300%2C155&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-srcset="https://i2.wp.com/dbatools.io/wp-content/uploads/2020/01/cli12a.png?w=905&amp;ssl=1 905w, https://i2.wp.com/dbatools.io/wp-content/uploads/2020/01/cli12a.png?resize=300%2C155&amp;ssl=1 300w, https://i2.wp.com/dbatools.io/wp-content/uploads/2020/01/cli12a.png?resize=768%2C396&amp;ssl=1 768w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="https://i2.wp.com/dbatools.io/wp-content/uploads/2020/01/cli12a.png?fit=300%2C155&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/aliases/" rel="bookmark">
                  working with sql client aliases                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
        
        <article class="post-10124 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/bits2020/" rel="bookmark">
                  <img width="300" height="108" src="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/07/dbatools-for-post.png?fit=300%2C108&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-src="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/07/dbatools-for-post.png?fit=300%2C108&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/bits2020/" rel="bookmark">
                  Vote for these SQLBits 2020 PowerShell sessions                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
        
        <article class="post-10010 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/size/" rel="bookmark">
                  <img width="300" height="139" src="https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?fit=300%2C139&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-srcset="https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?w=1139&amp;ssl=1 1139w, https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?resize=300%2C139&amp;ssl=1 300w, https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?resize=768%2C355&amp;ssl=1 768w, https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?resize=1024%2C473&amp;ssl=1 1024w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="https://i2.wp.com/dbatools.io/wp-content/uploads/2019/09/disksize.png?fit=300%2C139&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/size/" rel="bookmark">
                  working with file sizes in dbatools                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
        
        <article class="post-9995 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements tag-book tag-dbatoolsmol tag-monthoflunches">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/meap/" rel="bookmark">
                  <img width="300" height="159" src="https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?fit=300%2C159&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-srcset="https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?w=1287&amp;ssl=1 1287w, https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?resize=300%2C159&amp;ssl=1 300w, https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?resize=768%2C408&amp;ssl=1 768w, https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?resize=1024%2C543&amp;ssl=1 1024w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="https://i0.wp.com/dbatools.io/wp-content/uploads/2019/09/2019-09-04_13-00-161.png?fit=300%2C159&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/meap/" rel="bookmark">
                  Learn dbatools in a Month of Lunches                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
        
        <article class="post-9928 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/oldapp/" rel="bookmark">
                  <img width="300" height="108" src="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/07/dbatools-for-post.png?fit=300%2C108&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-src="https://i1.wp.com/dbatools.io/wp-content/uploads/2016/07/dbatools-for-post.png?fit=300%2C108&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/oldapp/" rel="bookmark">
                  migrating super old app databases                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
        
        <article class="post-9862 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements tag-dbatools-configs tag-dbatools-settings tag-defaults">

          <header>

                          <div class="entry-image">
                <a href="https://dbatools.io/configuration/" rel="bookmark">
                  <img width="300" height="202" src="https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?fit=300%2C202&amp;ssl=1" class="attachment-medium size-medium wp-post-image jetpack-lazy-image" alt="" data-lazy-srcset="https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?w=1104&amp;ssl=1 1104w, https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?resize=300%2C202&amp;ssl=1 300w, https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?resize=768%2C516&amp;ssl=1 768w, https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?resize=1024%2C688&amp;ssl=1 1024w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="https://i1.wp.com/dbatools.io/wp-content/uploads/2019/08/Get-DbatoolsConfig_Output.png?fit=300%2C202&amp;ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64 ,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 ">                </a>
              </div>
            
                          <h4 class="entry-title">
                <a href="https://dbatools.io/configuration/" rel="bookmark">
                  dbatools advanced configuration                </a>
              </h4>
            
            
          </header>

          
          <footer>

            
            
            
          </footer>

        </article>

      
  
</div>

</aside><aside id="blog_subscription-2" class="widget widget_blog_subscription jetpack_subscription_widget"><h2 class="widget-title">subscribe</h2>
            <form action="#" method="post" accept-charset="utf-8" id="subscribe-blog-blog_subscription-2">
				                    <div id="subscribe-text"><p>Enter your email address to subscribe to this blog and receive notifications of new posts by email.</p>
</div><p>Join 2,166 other subscribers</p>
                    <p id="subscribe-email">
                        <label id="jetpack-subscribe-label" class="screen-reader-text" for="subscribe-field-blog_subscription-2">
							email                        </label>
                        <input type="email" name="email" required="required" class="required" value="" id="subscribe-field-blog_subscription-2" placeholder="email">
                    </p>

                    <p id="subscribe-submit">
                        <input type="hidden" name="action" value="subscribe">
                        <input type="hidden" name="source" value="https://dbatools.io/keeping-availability-group-logins-in-sync-automatically/">
                        <input type="hidden" name="sub-type" value="widget">
                        <input type="hidden" name="redirect_fragment" value="blog_subscription-2">
						                        <button type="submit" name="jetpack_subscriptions_widget">
	                        subscribe                        </button>
                    </p>
				            </form>
		
</aside><aside id="eu_cookie_law_widget-3" class="widget widget_eu_cookie_law_widget"><div class="hide-on-button" data-hide-timeout="30" data-consent-expiration="180" id="eu-cookie-law">
	<form method="post">
		<input type="submit" value="Close and accept" class="accept">
	</form>

	Privacy &amp; Cookies: This site uses cookies. By continuing to use this website, you agree to their use. <br>
To find out more, including how to control cookies, see here:
	<a href="https://automattic.com/cookies/">
		Cookie Policy	</a>
</div>
</aside></div>
            
		</div>
	</div>

    <footer id="colophon" class="site-footer" role="contentinfo">
                    <div class="footer-connect">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-2"></div>
                        
                        <div class="col-sm-8">
                                                            <div class="footer-social">
                                    <h5 class="follow-heading">dbatools on the web</h5><div class="footer-social-icons"><a target="_blank" href="http://git.io/b3oo" title="github"><i class="fa fa-github"></i></a><a target="_blank" href="https://www.youtube.com/channel/UC1qrq0zfswSM_Uf9-vBrsiw" title="YouTube"><i class="fa fa-youtube"></i></a><a target="_blank" href="https://dbatools.io/slack" title="Slack"><i class="fa fa-slack"></i></a><a target="_blank" href="https://twitter.com/psdbatools" title="Twitter"><i class="fa fa-twitter"></i></a><a target="_blank" href="https://www.linkedin.com/company/dbatools.io" title="LinkedIn"><i class="fa fa-linkedin-square fa-linkedin"></i></a><a target="_blank" href="https://twitch.tv/dbatools" title="Twitch"><i class="fa fa-twitch"></i></a><a target="_blank" href="https://dbatools.io/book" title="Manning"><i class="fa fa-book fa-manning"></i></a></div>                                </div>
                                                    </div>
                        <div class="col-sm-2"></div>
                    </div>
                </div>
            </div>
        
        <div class="site-info">
            <div class="container">
                                &copy; 2020 Chrissy LeMaire, PowerShell and SQL Server MVP<br><a href="https://dbatools.io/contact">Contact Us</a>            </div>
        </div>
        

    </footer>
</div>

	<div style="display:none">
	<div class="grofile-hash-map-1a3e304860e301735b34b9ccca73c44b">
	</div>
	<div class="grofile-hash-map-ff150321310a91f2b4333dec7fe3deea">
	</div>
	<div class="grofile-hash-map-e9f48ed27456bcdeb961ecf4f03840dd">
	</div>
	<div class="grofile-hash-map-7add77da09816012f34497c500c78062">
	</div>
	<div class="grofile-hash-map-37af235980a2adcf560262ff9d6df7ec">
	</div>
	<div class="grofile-hash-map-b51d09a85eb791d79e84e11f43ec6a4d">
	</div>
	<div class="grofile-hash-map-d606d70a499d53d74d2bc9ed1d628a5b">
	</div>
	<div class="grofile-hash-map-9f06b52e3c9f4ca1949565307521cc8a">
	</div>
	<div class="grofile-hash-map-a59ad4b47d8c7fd4cb4ae137e6d2f91a">
	</div>
	<div class="grofile-hash-map-cc40167a97f1559a1436aa04b573d425">
	</div>
	<div class="grofile-hash-map-83c18e49de9b7ae4a9a1e92863fb7fe1">
	</div>
	<div class="grofile-hash-map-2e300eab9766054cdf39152655942b3c">
	</div>
	<div class="grofile-hash-map-11d6adc12ae0245f202eff0f9707d447">
	</div>
	<div class="grofile-hash-map-9e45a752c9e13362dc54f315843e095f">
	</div>
	<div class="grofile-hash-map-c6a605ed8a5f256a94d95b3faf22eb5c">
	</div>
	<div class="grofile-hash-map-7add77da09816012f34497c500c78062">
	</div>
	<div class="grofile-hash-map-1a276de5d579e6879f34c98f936cfc31">
	</div>
	</div>
<script type="text/javascript" src="https://c0.wp.com/p/jetpack/8.4.2/_inc/build/photon/photon.min.js"></script>
<script type="text/javascript" src="https://secure.gravatar.com/js/gprofiles.js?ver=202035"></script>
<script type="text/javascript">
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type="text/javascript" src="https://c0.wp.com/p/jetpack/8.4.2/modules/wpgroho.js"></script>
<script type="text/javascript" src="https://dbatools.io/wp-content/themes/onepress-master/assets/js/plugins.js?ver=11.0.0"></script>
<script type="text/javascript" src="https://dbatools.io/wp-content/themes/onepress-master/assets/js/bootstrap.min.js?ver=11.0.0"></script>
<script type="text/javascript" src="https://dbatools.io/wp-content/themes/onepress-master/assets/js/lightgallery.js?ver=11.0.0"></script>
<script type="text/javascript" src="https://dbatools.io/wp-content/themes/onepress-master/assets/js/theme.js?ver=11.0.0"></script>
<script type="text/javascript" src="https://c0.wp.com/p/jetpack/8.4.2/_inc/build/widgets/eu-cookie-law/eu-cookie-law.min.js"></script>
<script type="text/javascript" src="https://c0.wp.com/p/jetpack/8.4.2/_inc/build/lazy-images/js/lazy-images.min.js"></script>
<script type="text/javascript" src="https://dbatools.io/wp-content/plugins/onepress-plus/assets/js/onepress-plus.js?ver=10.1.8"></script>
<script async="async" type="text/javascript" src="https://dbatools.io/wp-content/plugins/akismet/_inc/form.js?ver=4.1.4"></script>

		
		<script type="text/javascript">
			(function () {
				var comm_par_el = document.getElementById( 'comment_parent' ),
					comm_par = ( comm_par_el && comm_par_el.value ) ? comm_par_el.value : '',
					frame = document.getElementById( 'jetpack_remote_comment' ),
					tellFrameNewParent;

				tellFrameNewParent = function () {
					if ( comm_par ) {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=111052036&postid=9655&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=mystery&greeting=Leave+a+Reply&greeting_reply=Leave+a+Reply+to+%25s&color_scheme=light&lang=en_US&jetpack_version=8.4.2&show_cookie_consent=10&has_cookie_consent=0&token_key=%3Bnormal%3B&sig=d1719adfeb1ac588e6735195a2eed5b73228e355#parent=https%3A%2F%2Fdbatools.io%2Fkeeping-availability-group-logins-in-sync-automatically%2F" + '&replytocom=' + parseInt( comm_par, 10 ).toString();
					} else {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=111052036&postid=9655&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=mystery&greeting=Leave+a+Reply&greeting_reply=Leave+a+Reply+to+%25s&color_scheme=light&lang=en_US&jetpack_version=8.4.2&show_cookie_consent=10&has_cookie_consent=0&token_key=%3Bnormal%3B&sig=d1719adfeb1ac588e6735195a2eed5b73228e355#parent=https%3A%2F%2Fdbatools.io%2Fkeeping-availability-group-logins-in-sync-automatically%2F";
					}
				};

				
				if ( 'undefined' !== typeof addComment ) {
					addComment._Jetpack_moveForm = addComment.moveForm;

					addComment.moveForm = function ( commId, parentId, respondId, postId ) {
						var returnValue = addComment._Jetpack_moveForm( commId, parentId, respondId, postId ),
							cancelClick, cancel;

						if ( false === returnValue ) {
							cancel = document.getElementById( 'cancel-comment-reply-link' );
							cancelClick = cancel.onclick;
							cancel.onclick = function () {
								var cancelReturn = cancelClick.call( this );
								if ( false !== cancelReturn ) {
									return cancelReturn;
								}

								if ( ! comm_par ) {
									return cancelReturn;
								}

								comm_par = 0;

								tellFrameNewParent();

								return cancelReturn;
							};
						}

						if ( comm_par == parentId ) {
							return returnValue;
						}

						comm_par = parentId;

						tellFrameNewParent();

						return returnValue;
					};
				}

				
				// Do the post message bit after the dom has loaded.
				document.addEventListener( 'DOMContentLoaded', function () {
					var iframe_url = "https:\/\/jetpack.wordpress.com";
					if ( window.postMessage ) {
						if ( document.addEventListener ) {
							window.addEventListener( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								jQuery( frame ).height( event.data );
							});
						} else if ( document.attachEvent ) {
							window.attachEvent( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								jQuery( frame ).height( event.data );
							});
						}
					}
				})

			})();
		</script>

		<script type="text/javascript" src="https://stats.wp.com/e-202035.js" async="async" defer></script>
<script type="text/javascript">
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.4.2',blog:'111052036',post:'9655',tz:'0',srv:'dbatools.io'} ]);
	_stq.push([ 'clickTrackerInit', '111052036', '9655' ]);
</script>

</body>
</html>
